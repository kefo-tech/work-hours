<!DOCTYPE html>
<!--
  ØªØ·Ø¨ÙŠÙ‚: Ø­Ø§Ø³ÙØ¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ / Arbeitszeitrechner
  Ø§Ù„Ù…Ø¤Ù„Ù: KeFo.tech
  Ø¥ØµÙ„Ø§Ø­Ø§Øª: 1) Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø¹Ø¯ Ø¸Ù‡ÙˆØ±Ù‡ ÙÙŠ DOM (Ù†Ù‚Ù„ <script> Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©)
           2) Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©ØŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙ‚Ø·
-->
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø­Ø§Ø³ÙØ¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Â· Arbeitszeitrechner</title>

  <style>
    /* --------- Ù‡ÙˆÙŠØ© Ù„ÙˆÙ†ÙŠØ© Ø¹Ø§Ù…Ø© --------- */
    :root{
      --bg:#0f172a; --panel:#111827; --panel-2:#1f2937;
      --muted:#9ca3af; --text:#e5e7eb;
      --primary:#22d3ee; --accent:#a78bfa; --success:#34d399;
      --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
    }
    *{box-sizing:border-box} html,body{height:100%}

    /* Ø®Ù„ÙÙŠØ© + Ø®Ø· */
    body{
      margin:0;
      font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(167,139,250,.15), transparent),
        radial-gradient(800px 400px at 10% 110%, rgba(34,211,238,.12), transparent),
        var(--bg);
      color:var(--text);
    }

    /* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ Ø«Ø§Ø¨Øª */
    header{
      position:sticky; top:0; z-index:5;
      backdrop-filter:saturate(140%) blur(10px);
      background:linear-gradient(180deg, rgba(15,23,42,.9), rgba(15,23,42,.6));
      border-bottom:1px solid rgba(255,255,255,.05);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:clamp(10px,3vw,16px)}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:clamp(6px,2vw,12px);flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--primary),var(--accent));color:#0b1020;font-weight:800;box-shadow:var(--shadow)}
    h1{font-size:1.25rem;margin:0;font-weight:800}

    .summary{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
    .chip{
      background:var(--panel-2);border:1px solid rgba(255,255,255,.06);
      padding:6px clamp(8px,2vw,12px);border-radius:999px;
      font-size:clamp(.78rem,2.4vw,.92rem);display:flex;gap:6px;align-items:center;min-height:32px
    }
    .chip b{color:#fff}

    .btn{
      appearance:none;border:0;background:var(--panel-2);color:var(--text);
      padding:8px 12px;border-radius:12px;cursor:pointer;box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.06);font-weight:700;transition:.2s transform,.2s opacity
    }
    .btn:hover{transform:translateY(-1px)}
    .btn-primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#0b1020}
    .btn-danger{background:linear-gradient(135deg,#fb7185,#fbbf24);color:#0b1020}

    main{max-width:1100px;margin:clamp(12px,3.5vw,24px) auto;padding:clamp(10px,3vw,16px)}
    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:clamp(12px,3vw,16px);overflow:hidden
    }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ */
    #setup{max-width:680px;margin:56px auto}
    .q{display:flex;flex-direction:column;gap:10px;margin:14px 0}
    label{color:#cbd5e1;font-weight:700}
    input[type="number"],input[type="time"],select{
      width:100%;background:var(--panel);border:1px solid rgba(255,255,255,.08);
      color:var(--text);padding:12px 14px;border-radius:12px;outline:none
    }
    .hint{color:var(--muted);font-size:.9rem}

    /* --------- Ø§Ù„ØªÙ‚ÙˆÙŠÙ… --------- */
    .month-header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;margin-bottom:10px}
    .month-title{text-align:center;font-size:clamp(1.05rem,4vw,1.3rem);font-weight:900}
    .nav{display:flex;gap:8px}

    /* Ø±Ø¤ÙˆØ³ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ */
    .cal-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:6px;width:100%}
    .dow{
      text-align:center;font-weight:700;color:var(--muted);
      font-size:clamp(.8rem,2.2vw,.95rem);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis; /* Ù…Ù†Ø¹ Ø§Ù„ØªØ´ÙˆÙ‡ */
      line-height:1.5;padding:8px 0;
    }

    /* Ø®Ù„Ø§ÙŠØ§ Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø± */
    .day{
      background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:14px;
      display:flex;flex-direction:column;align-items:center;justify-content:space-between;
      min-height:clamp(70px,13vw,100px);padding:6px;position:relative;
    }
    .day.disabled{opacity:.35;filter:grayscale(30%)}
    .today{outline:2px dashed var(--primary);outline-offset:2px}

    .day .dnum{font-weight:700;color:#fff;font-size:clamp(.9rem,2.8vw,1rem);margin-top:4px}

    /* Ø²Ø± Ø§Ù„Ù‚Ù„Ù… Ø«Ø§Ø¨Øª ÙˆØ®ÙÙŠÙ */
    .day .edit{
      position:absolute;top:6px;right:6px;background:none;border:none;color:var(--muted);
      cursor:pointer;font-size:.9rem;line-height:1;padding:2px 4px;border-radius:8px;
      transition:.2s;user-select:none;
    }
    .day .edit:hover{color:var(--primary)}

    .day .badge{
      font-size:clamp(.75rem,2.5vw,.9rem);
      padding:4px 8px;border-radius:10px;background:rgba(52,211,153,.15);
      border:1px solid rgba(52,211,153,.3);color:#a7f3d0;margin-bottom:4px;
    }

    /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:40}
    .modal{width:min(580px,94vw);background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
    .modal header{position:initial;background:var(--panel-2)}
    .modal .content{padding:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .footer{display:flex;justify-content:space-between;gap:10px;padding:12px 16px}

    /* --------- Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø· --------- */
    @media print{
      body{background:#fff;color:#000}
      header, footer, #setup, #calendar{display:none !important} /* Ø£Ø®ÙÙ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… */
      #printArea{display:block !important} /* Ø£Ø¸Ù‡Ø± Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙ‚Ø· */
    }

    footer{margin:24px auto;max-width:1100px;padding:0 16px 24px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
  <header>
    <div class="wrap topbar">
      <div class="brand"><div class="logo">â±ï¸</div><h1 id="appTitle">Ø­Ø§Ø³ÙØ¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</h1></div>
      <div class="summary">
        <div class="chip"><span id="lblMonthSum">Ø³Ø§Ø¹Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span> : <b id="sum-month">0:00</b></div>
        <div class="chip"><span id="lblOT">Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</span> : <b id="sum-ot">0:00</b></div>
        <div class="chip" style="gap:6px"><span id="lblLang">Ø§Ù„Ù„ØºØ©</span> :
          <select id="langSwitcher" class="btn"><option value="de">Deutsch</option><option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option></select>
        </div>
        <button class="btn" id="btnPrint">ğŸ–¨ï¸ <span id="lblPrint">ØªÙ‚Ø±ÙŠØ± PDF</span></button>
        <button class="btn" id="btnEditPolicy">âš™ï¸ <span id="lblSettings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></button>
        <button class="btn btn-danger" id="btnResetAll">ğŸ—‘ï¸ <span id="lblReset">ØªØµÙÙŠØ±</span></button>
      </div>
    </div>
  </header>

  <main>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ -->
    <section id="setup" class="panel" hidden>
      <h2 style="margin-top:0" id="setupTitle">Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ø±ÙŠØ¹</h2>
      <div class="q">
        <label for="officialHours" id="qOfficial">Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙŠÙˆÙ…ÙŠÙ‹Ø§</label>
        <input id="officialHours" type="number" min="1" max="24" step="0.25" placeholder="8" />
        <div class="hint" id="hintOfficial">Ø³ÙŠØªÙ… Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆÙ„Ù† ÙŠÙØ³Ø£Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.</div>
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button class="btn" id="setupSkip">ØªØ®Ø·ÙŠ</button>
        <button class="btn btn-primary" id="setupSave">Ø§Ù„ØªØ§Ù„ÙŠ</button>
      </div>
    </section>

    <!-- Ø§Ù„ØªÙ‚ÙˆÙŠÙ… -->
    <section id="calendar" class="panel" hidden>
      <div class="month-header">
        <div class="nav"><button class="btn" id="prevMonth">â—€</button></div>
        <div class="month-title" id="calTitle">â€”</div>
        <div class="nav"><button class="btn" id="nextMonth">â–¶</button></div>
      </div>
      <div class="cal-grid" id="dow"></div>   <!-- Ø±Ø¤ÙˆØ³ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ -->
      <div class="cal-grid" id="days"></div>  <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø£ÙŠØ§Ù… -->
    </section>

    <!-- Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø· -->
    <section id="printArea" style="display:none">
      <h2 id="reportTitle" style="margin:0 0 12px 0"></h2>
      <div id="reportMeta" style="margin-bottom:12px; color:#555"></div>
      <table id="reportTable" style="width:100%; border-collapse:collapse; font-family:system-ui">
        <thead><tr>
          <th style="border:1px solid #777; padding:6px; text-align:center" id="thDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th style="border:1px solid #777; padding:6px; text-align:center" id="thWorked">Ø§Ù„Ø¹Ù…Ù„</th>
          <th style="border:1px solid #777; padding:6px; text-align:center" id="thOT">Ø¥Ø¶Ø§ÙÙŠ</th>
        </tr></thead>
        <tbody id="reportBody"></tbody>
        <tfoot><tr>
          <th style="border:1px solid #777; padding:6px; text-align:center" id="thTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          <th style="border:1px solid #777; padding:6px; text-align:center" id="tdSumWorked">0:00</th>
          <th style="border:1px solid #777; padding:6px; text-align:center" id="tdSumOT">0:00</th>
        </tr></tfoot>
      </table>
      <div style="margin-top:12px; font-size:.9rem">Â© <span id="year"></span> KeFo.tech</div>
    </section>
  </main>

  <footer>Â© <span id="yearFoot"></span> KeFo.tech â€” <span id="rights">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span></footer>

  <!-- ====== Ø§Ù„Ù…ÙˆØ¯Ø§Ù„: ÙˆØ¶Ø¹Ù†Ø§Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ù„Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ====== -->
  <div class="modal-backdrop" id="modalBg" role="dialog" aria-modal="true">
    <div class="modal">
      <header class="wrap" style="padding:12px 16px; display:flex; align-items:center; justify-content:space-between">
        <div style="font-weight:800" id="modalTitle">â€”</div>
        <button class="btn" id="modalClose">âœ–</button>
      </header>
      <div class="content">
        <div class="row">
          <div class="q"><label id="lblStart">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…</label><input id="inStart" type="time" /></div>
          <div class="q"><label id="lblEnd">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…</label><input id="inEnd" type="time" /></div>
        </div>
        <div class="row">
          <div class="q"><label id="lblBreak">Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label><input id="inBreak" type="number" min="0" step="5" placeholder="30" /></div>
          <div class="q"><label id="lblTotal">Ø§Ù„Ù…Ø­ØµÙ„Ø© Ù„Ù„ÙŠÙˆÙ…</label><input id="inResult" type="text" disabled value="0:00" /></div>
        </div>
      </div>
      <div class="footer">
        <button class="btn" id="btnDeleteDay">ğŸ—‘ï¸ <span id="lblDeleteDay">Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span></button>
        <div style="display:flex; gap:10px">
          <button class="btn" id="btnNow">â±ï¸ <span id="lblNow">Ø§Ù„Ø¢Ù†</span></button>
          <button class="btn btn-primary" id="btnSaveDay">ğŸ’¾ <span id="lblSave">Ø­ÙØ¸</span></button>
        </div>
      </div>
    </div>
  </div>

  <!-- ====================== Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¢Ù† ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© ====================== -->
  <script>
    /* ==== ØªØ±Ø¬Ù…Ø© ==== */
    const i18n = {
      de:{appTitle:'Arbeitszeitrechner',monthSum:'Stunden dieses Monats',overtime:'Ãœberstunden',language:'Sprache',settings:'Einstellungen',reset:'ZurÃ¼cksetzen',print:'PDF-Bericht',setupTitle:'Schnelle Einrichtung',qOfficial:'Offizielle tÃ¤gliche Arbeitszeit (Stunden)',hintOfficial:'Diese Einstellung wird gespeichert. Du kannst sie spÃ¤ter in den Einstellungen Ã¤ndern.',skip:'Ãœberspringen',next:'Weiter',weekdays:['Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag','Sonntag'],start:'Arbeitsbeginn',end:'Arbeitsende',break:'Pause (Minuten)',total:'Tagesergebnis',deleteDay:'Tag lÃ¶schen',now:'Jetzt',save:'Speichern',noData:'â€”',rights:'Alle Rechte vorbehalten',errHours:'Bitte eine Zahl zwischen 1 und 24 eingeben.',errTimes:'Bitte Beginn und Ende eingeben.',reportTitle:'Monatsbericht',thDate:'Datum',thWorked:'Arbeitszeit',thOT:'Ãœberstunden',thTotal:'Summe'},
      ar:{appTitle:'Ø­Ø§Ø³ÙØ¨ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„',monthSum:'Ø³Ø§Ø¹Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±',overtime:'Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ',language:'Ø§Ù„Ù„ØºØ©',settings:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',reset:'ØªØµÙÙŠØ±',print:'ØªÙ‚Ø±ÙŠØ± PDF',setupTitle:'Ø¥Ø¹Ø¯Ø§Ø¯ Ø³Ø±ÙŠØ¹',qOfficial:'Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙŠÙˆÙ…ÙŠÙ‹Ø§ (Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª)',hintOfficial:'Ø³ÙŠØªÙ… Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.',skip:'ØªØ®Ø·ÙŠ',next:'Ø§Ù„ØªØ§Ù„ÙŠ',weekdays:['Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª','Ø§Ù„Ø£Ø­Ø¯'],start:'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…',end:'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…',break:'Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)',total:'Ø§Ù„Ù…Ø­ØµÙ„Ø© Ù„Ù„ÙŠÙˆÙ…',deleteDay:'Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…',now:'Ø§Ù„Ø¢Ù†',save:'Ø­ÙØ¸',noData:'â€” Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª â€”',rights:'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©',errHours:'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ø¨ÙŠÙ† 1 Ùˆ 24',errTimes:'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©',reportTitle:'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±',thDate:'Ø§Ù„ØªØ§Ø±ÙŠØ®',thWorked:'Ø§Ù„Ø¹Ù…Ù„',thOT:'Ø¥Ø¶Ø§ÙÙŠ',thTotal:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'}
    };

    /* ==== Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ==== */
    const $ = s=>document.querySelector(s);
    const pad = n=>String(n).padStart(2,'0');
    const fmtHM = m=>{const s=Math.max(0,Math.round(m||0));return `${Math.floor(s/60)}:${pad(s%60)}`};
    const toKey=(y,m,d)=>`${y}-${pad(m+1)}-${pad(d)}`;

    /* ==== Ø§Ù„ØªØ®Ø²ÙŠÙ† ==== */
    const store={
      get hours(){return parseFloat(localStorage.getItem('officialDailyHours')||'0')||0},
      set hours(v){localStorage.setItem('officialDailyHours',String(v))},
      get logs(){return JSON.parse(localStorage.getItem('workLogs')||'{}')},
      set logs(o){localStorage.setItem('workLogs',JSON.stringify(o))},
      get lang(){return localStorage.getItem('lang')||autoDetectLang()},
      set lang(v){localStorage.setItem('lang',v)},
      reset(){localStorage.removeItem('workLogs');localStorage.removeItem('officialDailyHours')}
    };

    let view=new Date(); let activeKey=null;

    function autoDetectLang(){const nav=(navigator.language||'de').toLowerCase();if(nav.startsWith('ar'))return'ar';if(nav.startsWith('de'))return'de';return'de'}

    function applyLang(){
      const lang=store.lang; const t=i18n[lang]||i18n.de;
      document.documentElement.lang=lang;
      document.documentElement.dir=(lang==='ar')?'rtl':'ltr';
      $('#appTitle').textContent=t.appTitle; $('#lblMonthSum').textContent=t.monthSum; $('#lblOT').textContent=t.overtime; $('#lblLang').textContent=t.language; $('#lblSettings').textContent=t.settings; $('#lblReset').textContent=t.reset; $('#lblPrint').textContent=t.print; $('#setupTitle').textContent=t.setupTitle; $('#qOfficial').textContent=t.qOfficial; $('#hintOfficial').textContent=t.hintOfficial; $('#setupSkip').textContent=t.skip; $('#setupSave').textContent=t.next; $('#rights').textContent=t.rights;
      renderWeekdays(); renderCalendarTitle(); updateSummary();
      $('#reportTitle').textContent=`${t.reportTitle} â€” ${new Intl.DateTimeFormat(lang,{month:'long',year:'numeric'}).format(view)}`;
      $('#thDate').textContent=t.thDate; $('#thWorked').textContent=t.thWorked; $('#thOT').textContent=t.thOT; $('#thTotal').textContent=t.thTotal;
    }

    function renderWeekdays(){
      const lang=store.lang; const t=i18n[lang]||i18n.de; const dow=$('#dow'); if(!dow) return; dow.innerHTML='';
      for(const name of t.weekdays){const el=document.createElement('div'); el.className='dow'; el.textContent=name; dow.appendChild(el);}
    }
    function renderCalendarTitle(){const lang=store.lang; const el=$('#calTitle'); if(el) el.textContent=new Intl.DateTimeFormat(lang,{month:'long',year:'numeric'}).format(view);}

    function renderCalendar(){
      const y=view.getFullYear(), m=view.getMonth(); renderCalendarTitle();
      const first=new Date(y,m,1), last=new Date(y,m+1,0);
      const firstDow=(first.getDay()+6)%7; // Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†=0
      const totalCells=firstDow+last.getDate();
      const daysEl=$('#days'); if(!daysEl) return; daysEl.innerHTML='';
      for(let i=0;i<totalCells;i++){
        const cell=document.createElement('div');
        if(i<firstDow){cell.className='day disabled';daysEl.appendChild(cell);continue;}
        const d=i-firstDow+1; const key=toKey(y,m,d); cell.className='day';
        const today=new Date();
        if(y===today.getFullYear()&&m===today.getMonth()&&d===today.getDate()) cell.classList.add('today');
        const dnum=document.createElement('div'); dnum.className='dnum'; dnum.textContent=d; cell.appendChild(dnum);
        const log=store.logs[key]; const res=document.createElement('div'); res.className='badge'; res.textContent=log?fmtHM(log.worked):(i18n[store.lang]||i18n.de).noData; cell.appendChild(res);
        const editBtn=document.createElement('button'); editBtn.className='edit'; editBtn.textContent='âœ'; editBtn.title='Edit'; editBtn.onclick=()=>openDayModal(key); cell.appendChild(editBtn);
        daysEl.appendChild(cell);
      }
    }

    function updateSummary(){
      const y=view.getFullYear(), m=view.getMonth(); const logs=store.logs; let total=0, ot=0;
      for(const k in logs){const [yy,mm]=k.split('-').map(Number); if(yy===y&&mm===m+1){total+=logs[k].worked||0; ot+=Math.max(0,(logs[k].worked||0)-store.hours*60);}}
      $('#sum-month').textContent=fmtHM(total); $('#sum-ot').textContent=fmtHM(ot);
    }

    function openDayModal(key){
      activeKey=key; const existing=store.logs[key]; const dt=new Date(key); const lang=store.lang;
      $('#modalTitle').textContent=new Intl.DateTimeFormat(lang,{weekday:'long',day:'numeric',month:'long',year:'numeric'}).format(dt);
      $('#inStart').value=existing?.start||''; $('#inEnd').value=existing?.end||''; $('#inBreak').value=existing?.break??''; $('#inResult').value=existing?fmtHM(existing.worked):'0:00';
      $('#modalBg').style.display='flex';
    }
    function closeModal(){const bg=$('#modalBg'); if(bg) bg.style.display='none'; activeKey=null;}

    function computeWorkedMins(start,end,brk){
      if(!start||!end) return 0;
      const [sh,sm]=start.split(':').map(Number); const [eh,em]=end.split(':').map(Number);
      let s=sh*60+sm, e=eh*60+em; if(e<s) e+=1440; // Ø¯Ø¹Ù… Ø¹Ø¨ÙˆØ± Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
      return Math.max(0, e - s - (parseInt(brk||0)));
    }

    function wireModal(){
      // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± (ÙÙŠ Ø­Ø§Ù„ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ø§Ø­Ù‚Ø©)
      const inStart=$('#inStart'), inEnd=$('#inEnd'), inBreak=$('#inBreak'), inResult=$('#inResult');
      const btnSave=$('#btnSaveDay'), btnDelete=$('#btnDeleteDay'), btnClose=$('#modalClose'), btnNow=$('#btnNow'), bg=$('#modalBg');

      const recalc=()=>{ inResult.value = fmtHM(computeWorkedMins(inStart.value, inEnd.value, inBreak.value)); };
      [inStart,inEnd,inBreak].forEach(el=>el && el.addEventListener('input', recalc));

      btnSave && (btnSave.onclick=()=>{
        if(!activeKey) return;
        const start=inStart.value, end=inEnd.value, brk=parseInt(inBreak.value||0);
        const t=i18n[store.lang]||i18n.de;
        if(!start||!end){ alert(t.errTimes); return; }
        const worked=computeWorkedMins(start,end,brk);
        const logs=store.logs; logs[activeKey]={start,end,break:brk,worked}; store.logs=logs;
        renderCalendar(); updateSummary(); closeModal(); // << ÙŠØºÙ„Ù‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
      });

      btnDelete && (btnDelete.onclick=()=>{
        if(!activeKey) return;
        const logs=store.logs; delete logs[activeKey]; store.logs=logs;
        renderCalendar(); updateSummary(); closeModal();
      });

      btnClose && (btnClose.onclick=closeModal);
      bg && bg.addEventListener('click',e=>{ if(e.target.id==='modalBg') closeModal(); });

      btnNow && (btnNow.onclick=()=>{
        const now=new Date();
        inStart.value=`${pad(now.getHours())}:${pad(now.getMinutes())}`;
        inEnd.value=`${pad((now.getHours()+8)%24)}:${pad(now.getMinutes())}`;
        inBreak.value=30;
        inResult.value=fmtHM(computeWorkedMins(inStart.value,inEnd.value,inBreak.value));
      });
    }

    function wireCalendarNav(){
      $('#prevMonth').onclick=()=>{view=new Date(view.getFullYear(),view.getMonth()-1,1);renderCalendar();updateSummary();};
      $('#nextMonth').onclick=()=>{view=new Date(view.getFullYear(),view.getMonth()+1,1);renderCalendar();updateSummary();};
      $('#btnResetAll').onclick=()=>{ if(confirm('OK?')){store.reset(); refreshVisibility(); renderCalendar(); updateSummary(); $('#setup').hidden=false; $('#calendar').hidden=true;} };
      $('#btnPrint').onclick=()=>{ buildReport(); window.print(); }; // Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø³ÙŠÙØ®ÙÙ‰ ÙƒÙ„ Ø´ÙŠØ¡ Ø¹Ø¯Ø§ #printArea
    }

    function refreshVisibility(){const hasHours=store.hours>0; $('#setup').hidden=hasHours; $('#calendar').hidden=!hasHours;}

    function initSetup(){
      const input=$('#officialHours'); if(store.hours>0) input.value=store.hours;
      $('#setupSave').onclick=()=>{const val=parseFloat(input.value); const t=i18n[store.lang]||i18n.de; if(!val||val<=0||val>24){alert(t.errHours);return} store.hours=val; refreshVisibility(); renderCalendar(); updateSummary();};
      $('#setupSkip').onclick=()=>{store.hours=8; refreshVisibility(); renderCalendar(); updateSummary();};
      $('#btnEditPolicy').onclick=()=>{$('#setup').hidden=false; $('#calendar').hidden=true;};
    }

    function wireLang(){
      const sel=$('#langSwitcher'); sel.value=store.lang;
      sel.addEventListener('change',()=>{store.lang=sel.value; applyLang(); renderCalendar(); updateSummary();});
    }

    function buildReport(){
      const lang=store.lang; const t=i18n[lang]||i18n.de; const y=view.getFullYear(), m=view.getMonth();
      $('#reportTitle').textContent=`${t.reportTitle} â€” ${new Intl.DateTimeFormat(lang,{month:'long',year:'numeric'}).format(view)}`;
      $('#reportMeta').textContent=`${t.qOfficial}: ${store.hours}h`;
      const body=$('#reportBody'); body.innerHTML='';
      let sumW=0,sumOT=0; const last=new Date(y,m+1,0);
      for(let d=1; d<=last.getDate(); d++){
        const key=toKey(y,m,d); const log=store.logs[key]; const worked=log?log.worked:0; const ot=Math.max(0, worked - store.hours*60); sumW+=worked; sumOT+=ot;
        const tr=document.createElement('tr');
        const td1=document.createElement('td'); td1.style='border:1px solid #777; padding:6px; text-align:center';
        const td2=document.createElement('td'); td2.style=td1.style;
        const td3=document.createElement('td'); td3.style=td1.style;
        td1.textContent=new Intl.DateTimeFormat(lang,{day:'2-digit',month:'2-digit',year:'numeric'}).format(new Date(y,m,d));
        td2.textContent=log?fmtHM(worked):(t.noData.includes('â€”')?'â€”':t.noData);
        td3.textContent=fmtHM(ot);
        tr.append(td1,td2,td3); body.appendChild(tr);
      }
      $('#tdSumWorked').textContent=fmtHM(sumW); $('#tdSumOT').textContent=fmtHM(sumOT);
    }

    /* ==== Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ DOM ==== */
    document.addEventListener('DOMContentLoaded', ()=>{
      const yr=new Date().getFullYear(); $('#year').textContent=yr; $('#yearFoot').textContent=yr;
      if(!localStorage.getItem('lang')) store.lang=autoDetectLang();
      wireLang(); applyLang(); initSetup(); refreshVisibility(); renderCalendar(); updateSummary(); wireCalendarNav(); wireModal();
      // Ø¥Ø°Ø§ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø§Ø¹Ø§Øª Ø±Ø³Ù…ÙŠØ© Ø¨Ø¹Ø¯ØŒ Ø§Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
      if(!(store.hours>0)) $('#setup').hidden=false; else $('#calendar').hidden=false;
    });
  </script>
</body>
</html>
